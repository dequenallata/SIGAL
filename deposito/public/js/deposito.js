"use strict";var deposito=angular.module("deposito",["ui.bootstrap","angularUtils.directives.dirPagination","ngSanitize","ui.select","directive.loading"]);deposito.config(function($interpolateProvider){$interpolateProvider.startSymbol("{#"),$interpolateProvider.endSymbol("#}")}).filter("capitalize",function(){return function(input,all){return input?input.replace(/([^\W_]+[^\s-]*) */g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}):""}}).filter("propsFilter",function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach(function(item){for(var itemMatches=!1,i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(item[prop].toString().toLowerCase().indexOf(text)!==-1){itemMatches=!0;break}}itemMatches&&out.push(item)})}else out=items;return out}}).filter("codeforma",function(){return function(input){if(input)return length=input.indexOf("-")+1,input.substring(length)}}),angular.module("directive.loading",[]).directive("loading",["$http",function($http){return{restrict:"A",link:function(scope,elm,attrs){scope.isLoading=function(){return $http.pendingRequests.length>0},scope.$watch(scope.isLoading,function(v){v?elm.show():elm.hide()})}}}]),deposito.controller("menuController",function($scope,$http,$modal){$scope.deposito=function(){$modal.open({animation:!0,templateUrl:"/cambiarDeposito",controller:"cambiaDepositoController",resolve:{obtenerUsuarios:function(){return $scope.obtenerUsuarios}}})},$scope.password=function(){$modal.open({animation:!0,templateUrl:"/cambiarPassword",controller:"cambiaPasswordController"})}}),deposito.controller("cambiaDepositoController",function($scope,$http,$modalInstance){$scope.deposito,$scope.depositos=[],$scope.alert={},$http.get("/getDeposito").success(function(response){$scope.deposito=response}),$http.get("/depositos/getDepositos").success(function(response){$scope.depositos=response}),$scope.modificar=function(){$scope.save()},$scope.save=function(){var data={deposito:$scope.depositoM};$http.post("/editarDeposito",data).success(function(response){return"success"==response.status?($modalInstance.dismiss("cancel"),void location.reload()):void($scope.alert={type:response.status,msg:response.menssage})})},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(){$scope.alert={}}}),deposito.controller("cambiaPasswordController",function($scope,$http,$modalInstance){$scope.alert={},$scope.data={},$scope.modificar=function(){$scope.save()},$scope.save=function(){$http.post("/cambiarPassword",$scope.data).success(function(response){return"success"==response.status?void $modalInstance.dismiss("cancel"):void($scope.alert={type:response.status,msg:response.menssage})})},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(){$scope.alert={}}}),$(document).ready(function(){function hamburger_cross(){1==isClosed?(overlay.hide(),trigger.removeClass("is-open"),trigger.addClass("is-closed"),isClosed=!1):(overlay.show(),trigger.removeClass("is-closed"),trigger.addClass("is-open"),isClosed=!0)}var trigger=$(".hamburger"),overlay=$(".overlay"),isClosed=!1;trigger.click(function(){hamburger_cross()}),$('[data-toggle="offcanvas"]').click(function(){$("#wrapper").toggleClass("toggled")})}),$(window).load(function(){$("#loader").fadeOut("fast")}),angular.module("deposito").controller("departamentosController",function($scope,$http,$modal){$scope.departamentos=[],$scope.cRegistro="5",$scope.obtenerDepartamentos=function(){$http.get("/getDepartamentos").success(function(response){$scope.departamentos=response})},$scope.registrarDepartamento=function(){$modal.open({animation:!0,templateUrl:"/registrarDepartamento",size:"lg",controller:"registrarDepartamentoCtrl",resolve:{obtenerDepartamentos:function(){return $scope.obtenerDepartamentos}}})},$scope.editarDepartamento=function(index){$modal.open({animation:!0,templateUrl:"/editarDepartamento",size:"lg",controller:"editarDepartamentoCtrl",resolve:{obtenerDepartamentos:function(){return $scope.obtenerDepartamentos},id:function(){return index}}})},$scope.eliminarDepartamento=function(index){$modal.open({animation:!0,templateUrl:"/eliminarDepartamento",controller:"eliminarDepartamentoCtrl",resolve:{obtenerDepartamentos:function(){return $scope.obtenerDepartamentos},id:function(){return index}}})},$scope.obtenerDepartamentos()}),angular.module("deposito").controller("registrarDepartamentoCtrl",function($scope,$modalInstance,$http,obtenerDepartamentos){$scope.btnVisivilidad=!0,$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/registrarDepartamento",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDepartamentos()})}}),angular.module("deposito").controller("editarDepartamentoCtrl",function($scope,$modalInstance,$http,obtenerDepartamentos,id){$scope.btnVisivilidad=!0,$scope.nombre="",$http.get("/getDepartamento/"+id).success(function(response){$scope.nombre=response.nombre}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/editarDepartamento/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDepartamentos()})}}),angular.module("deposito").controller("eliminarDepartamentoCtrl",function($scope,$modalInstance,$http,obtenerDepartamentos,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/eliminarDepartamento/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDepartamentos()})}}),angular.module("deposito").controller("depositosController",function($scope,$http,$modal){$scope.deposito=[],$scope.cRegistro="5",$scope.obtenerDepositos=function(){$http.get("/depositos/getDepositos").success(function(response){$scope.depositos=response})},$scope.registrarDeposito=function(){$modal.open({animation:!0,templateUrl:"/depositos/registrarDeposito",size:"lg",controller:"registrarDepositoCtrl",resolve:{obtenerDepositos:function(){return $scope.obtenerDepositos}}})},$scope.editarDeposito=function(index){$modal.open({animation:!0,templateUrl:"/depositos/editarDeposito",size:"lg",controller:"editarDepositoCtrl",resolve:{obtenerDepositos:function(){return $scope.obtenerDepositos},id:function(){return index}}})},$scope.eliminarDeposito=function(index){$modal.open({animation:!0,templateUrl:"/depositos/eliminarDeposito",controller:"eliminarDepositoCtrl",resolve:{obtenerDepositos:function(){return $scope.obtenerDepositos},id:function(){return index}}})},$scope.obtenerDepositos()}),angular.module("deposito").controller("registrarDepositoCtrl",function($scope,$modalInstance,$http,obtenerDepositos){$scope.btnVisivilidad=!0,$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/depositos/registrarDeposito",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDepositos()})}}),angular.module("deposito").controller("editarDepositoCtrl",function($scope,$modalInstance,$http,obtenerDepositos,id){$scope.btnVisivilidad=!0,$scope.nombre="",$http.get("/depositos/getDeposito/"+id).success(function(response){$scope.nombre=response.nombre,$scope.codigo=response.codigo}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/depositos/editarDeposito/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDepositos()})}}),angular.module("deposito").controller("eliminarDepositoCtrl",function($scope,$modalInstance,$http,obtenerDepositos,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/depositos/eliminarDeposito/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDepositos()})}}),angular.module("deposito").controller("documentosController",function($scope,$http,$modal){$scope.documentos=[],$scope.cRegistro="5",$scope.obtenerDocumentos=function(){$http.get("/documentos/all").success(function(response){$scope.documentos=response})},$scope.registrarDocumento=function(){$modal.open({animation:!0,templateUrl:"/documentos/registrar",size:"lg",controller:"registrarDocumentoCtrl",resolve:{obtenerDocumentos:function(){return $scope.obtenerDocumentos}}})},$scope.editarDocumento=function(index){$modal.open({animation:!0,templateUrl:"/documentos/editar",size:"lg",controller:"editarDocumentoCtr",resolve:{obtenerDocumentos:function(){return $scope.obtenerDocumentos},id:function(){return index}}})},$scope.eliminarDocumento=function(index){$modal.open({animation:!0,templateUrl:"/documentos/eliminar",controller:"eliminarDocumentoCtrl",resolve:{obtenerDocumentos:function(){return $scope.obtenerDocumentos},id:function(){return index}}})},$scope.obtenerDocumentos()}),angular.module("deposito").controller("registrarDocumentoCtrl",function($scope,$modalInstance,$http,obtenerDocumentos){$scope.btnVisivilidad=!0,$scope.registro={},$scope.registro.tipo="proveedor",$scope.registro.naturaleza="entrada",$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){$http.post("/documentos/registrar",$scope.registro).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDocumentos()})}}),angular.module("deposito").controller("editarDocumentoCtr",function($scope,$modalInstance,$http,obtenerDocumentos,id){$scope.btnVisivilidad=!0,$http.get("/documentos/get/"+id).success(function(response){$scope.registro=response,$scope.registroCopi={abreviatura:response.abreviatura,nombre:response.nombre,tipo:response.tipo,uso:response.uso}}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)};var setData=function(){var data={};return $scope.registro.abreviatura!=$scope.registroCopi.abreviatura&&(data.abreviatura=$scope.registro.abreviatura),$scope.registro.nombre!=$scope.registroCopi.nombre&&(data.nombre=$scope.registro.nombre),$scope.registro.tipo!=$scope.registroCopi.tipo&&(data.tipo=$scope.registro.tipo),$scope.registro.uso!=$scope.registroCopi.uso&&(data.uso=$scope.registro.uso),data};$scope.save=function(){$http.post("documentos/editar/"+id,setData()).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDocumentos()})}}),angular.module("deposito").controller("eliminarDocumentoCtrl",function($scope,$modalInstance,$http,obtenerDocumentos,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/documentos/eliminar/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerDocumentos()})}}),angular.module("deposito").controller("entradasController",function($scope,$http,$modal){$scope.entradas=[],$scope.insumos=[],$scope.indice="Pro-Formas",$scope.cRegistro="5",$scope.status=!0;var obtenerEntradas=function(){$http.get("/entradas/getEntradas/").success(function(response){$scope.entradas=response})},obtenerInsumos=function(datos){$http.get("/entradas/getInsumos").success(function(response){$scope.insumos=response})};$scope.registrosProformas=function(){$scope.busqueda="",$scope.indice="Pro-Formas",$scope.insumos=[],$scope.status=!0,obtenerEntradas()},$scope.registrosInsumos=function(){$scope.busqueda="",$scope.indice="Insumos",$scope.insumos=[],$scope.status=!1,obtenerInsumos()},$scope.detallesOrden=function(orden){$http.get("/entradas/getOrden/"+orden).success(function(response){$scope.orden=response.orden,$scope.insumos=response.insumos,$scope.busqueda="",$scope.indice="Orden"})},$scope.detallesEntrada=function(index){$modal.open({animation:!0,templateUrl:"/entradas/detalles",controller:"detallesEntradaCtrl",windowClass:"large-Modal",resolve:{id:function(){return index}}})},obtenerEntradas()}),angular.module("deposito").controller("detallesEntradaCtrl",function($scope,$modalInstance,$http,id){$scope.entrada={},$scope.insumos=[],$scope.visibility=!1,$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.chvisibility=function(){$scope.search={},$scope.visibility=!$scope.visibility},$scope.detalles=function(){$http.get("/entradas/getEntrada/"+id).success(function(response){$scope.nota=response.nota,$scope.insumos=response.insumos})},$scope.detalles(id)}),angular.module("deposito").controller("estadisticasController",function($scope,$http){function estadisticas(){$http.get("/getEstadisticas").success(function(response){chartOption.series[0].data=response.Sdata,chartOption.drilldown.series=response.Ddata,chartOption.yAxis.title.text="Salidas de insumos",chartOption.title.text=response.title,chartOption.subtitle.text="Haga click en una columna para ver los insumos que han salido por servicio",$(function(){$("#graficaInicial").highcharts(chartOption)})})}function dataForamat(data){if(null!=data){var month=data.getMonth()+1,day=data.getDate();return day<10&&(day="0"+day),month<10&&(month="0"+month),data.getFullYear()+"-"+month+"-"+day}}$scope.formVisivility=!0,$scope.servicio=null,$scope.departamentos=[],$scope.listInsumos=[],$scope.insumoSelect={},$scope.alert={},$scope.dI=null,$scope.dF=null,$scope.searchAjax=!1,$http.get("/getDepartamentos").success(function(response){$scope.departamentos=response}),$scope.openI=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.openedI=!0},$scope.openF=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.openedF=!0},$scope.refreshInsumos=function(insumo){$scope.searchAjax=!0;var params={insumo:insumo};return $http.get("/getInsumosConsulta",{params:params}).then(function(response){$scope.listInsumos=response.data})},$scope.formConsulta=function(){$scope.formVisivility=!1},$scope.formCerrar=function(){$scope.formVisivility=!0};var chartOption={chart:{type:"column"},title:{text:""},subtitle:{text:""},xAxis:{type:"category"},yAxis:{title:{text:""}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y}</b> Unidades<br/>'},series:[{name:"Salidas",colorByPoint:!0,data:[]}],drilldown:{series:[]}};$scope.closeAlert=function(){$scope.alert={}},$scope.consultaInsumo=function(){$scope.searchAjax=!1;var data={fechaI:dataForamat($scope.dI),fechaF:dataForamat($scope.dF),insumo:$scope.insumoSelect.hasOwnProperty("selected")?$scope.insumoSelect.selected.id:null};$http.post("/estadisticasInsumo",data).success(function(response){return"success"==response.status?(chartOption.title.text=response.title,chartOption.subtitle.text="",chartOption.series[0].data=response.data,chartOption.drilldown.series=[],void $(function(){$("#graficaInicial").highcharts(chartOption)})):void($scope.alert={type:response.status,msg:response.menssage})})},$scope.consultaServicio=function(){var data={fechaI:dataForamat($scope.dI),fechaF:dataForamat($scope.dF),servicio:$scope.servicio};$http.post("/estadisticasServicio",data).success(function(response){return"success"==response.status?(chartOption.title.text=response.title,chartOption.subtitle.text="",chartOption.series[0].data=response.data,chartOption.drilldown.series=[],void $(function(){$("#graficaInicial").highcharts(chartOption)})):void($scope.alert={type:response.status,msg:response.menssage})})},estadisticas()}),angular.module("deposito").controller("alertController",function($scope,$http){function insumoExist(codigo){var index;for(index in $scope.insumos)if($scope.insumos[index].codigo==codigo)return!0;return!1}function empaquetaData(){var index,insumos=[];for(index in $scope.insumos)insumos.push({id:$scope.insumos[index].id,min:$scope.insumos[index].min,med:$scope.insumos[index].med});return insumos}function restablecer(){$scope.insumos=[]}function validaCantidad(){var index;for(index in $scope.insumos){if(!$scope.insumos[index].min||$scope.insumos[index].min<=0||!Number.isInteger($scope.insumos[index].min))return!1;if(!$scope.insumos[index].med||$scope.insumos[index].med<=0||!Number.isInteger($scope.insumos[index].med))return!1;if($scope.insumos[index].min>=$scope.insumos[index].med)return!1}return!0}$scope.insumoSelect={},$scope.listInsumos=[],$scope.insumos=[],$scope.refreshInsumos=function(insumo){var params={insumo:insumo};return $http.get("/inventario/herramientas/getInventarioAlert",{params:params}).then(function(response){$scope.listInsumos=response.data})},$scope.agregarInsumos=function(){return $scope.insumoSelect.selected?insumoExist($scope.insumoSelect.selected.codigo)?void($scope.alert={type:"danger",msg:"Este insumo ya se ha agregado"}):($scope.insumos.unshift({id:$scope.insumoSelect.selected.id,codigo:$scope.insumoSelect.selected.codigo,descripcion:$scope.insumoSelect.selected.descripcion,min:$scope.insumoSelect.selected.min,med:$scope.insumoSelect.selected.med}),void($scope.insumoSelect={})):void($scope.alert={type:"danger",msg:"Por favor especifique un insumo"})},$scope.eliminarInsumo=function(index){$scope.insumos.splice(index,1)},$scope.existInsumos=function(){return 0!=$scope.insumos.length},$scope.closeAlert=function(){$scope.alert={},$},$scope.guardar=function(){if(!validaCantidad())return void($scope.alert={type:"danger",msg:"Especifique un valor valido para cada insumo"});var data={insumos:empaquetaData()};$http.post("/inventario/herramientas/estableceAlarmas",data).success(function(response){$scope.alert={type:response.status,msg:response.menssage},"success"==response.status&&($scope.alert={type:response.status,msg:response.menssage},restablecer())})}}).controller("cargaInvController",function($scope,$http,$modal){function insumoExist(codigo,insumos){var index;for(index in insumos)if(insumos[index].codigo==codigo)return!0;return!1}function empaquetaData(insumosOri){var index,insumos=[];for(index in insumosOri)insumos.push({id:insumosOri[index].id,cantidad:insumosOri[index].cantidad});return insumos}function validaCantidad(insumos){var index;for(index in insumos)if(!insumos[index].cantidad||insumos[index].cantidad<0||!Number.isInteger($scope.insumos[index].cantidad))return!1;return!0}$scope.insumoSelect={},$scope.departamentos=[],$scope.departamento,$scope.insumos=[],$scope.listInsumos=[],$scope.alert={type:"warning",msg:"Precaucion! la carga de inventario eliminara todos los insumos cargados previamente."},$scope.refreshInsumos=function(insumo){var params={insumo:insumo};return $http.get("/getInsumosConsulta",{params:params}).then(function(response){$scope.listInsumos=response.data})},$scope.agregarInsumos=function(){return $scope.insumoSelect.selected?insumoExist($scope.insumoSelect.selected.codigo,$scope.insumos)?void($scope.alert={type:"danger",msg:"Este insumo ya se ha agregado en esta entrada"}):($scope.insumos.unshift({id:$scope.insumoSelect.selected.id,codigo:$scope.insumoSelect.selected.codigo,descripcion:$scope.insumoSelect.selected.descripcion}),void($scope.insumoSelect={})):void($scope.alert={type:"danger",msg:"Por favor especifique un insumo"})},$scope.closeAlert=function(){$scope.alert={}},$scope.thereInsumos=function(){return $scope.insumos.length>0},$scope.eliminarInsumo=function(index){$scope.insumos.splice(index,1)},$scope.restablecer=function(){$scope.insumos=[],$scope.alert={}},$scope.registrar=function(){return validaCantidad($scope.insumos)?($scope.modalInstance=$modal.open({animation:!0,templateUrl:"confirmeRegister.html",scope:$scope}),$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},void($scope.cofirme=function(){save(),$scope.modalInstance.dismiss("cancel"),$scope.loader=!0})):void($scope.alert={type:"danger",msg:"Especifique un valor valido para cada insumo"})};var save=function(){var data={insumos:empaquetaData($scope.insumos)};$http.post("/inventario/herramientas/cargaInventario",data).success(function(response){return $scope.loader=!1,"success"==response.status?($modal.open({animation:!0,templateUrl:"successRegister.html",controller:"successRegisterCtrl",resolve:{response:function(){return response}}}),void $scope.restablecer()):void($scope.alert={type:response.status,msg:response.menssage})})}}).controller("listCargasController",function($scope,$http,$modal){$scope.entradas=[],$scope.cRegistro="5",$http.get("/inventario/herramientas/getInventarioCargas").success(function(response){$scope.entradas=response}),$scope.detallesCarga=function(index){$modal.open({animation:!0,templateUrl:"/inventario/herramientas/detallesCarga",controller:"detallesCargaCtrl",windowClass:"large-Modal",resolve:{id:function(){return index}}})}}),angular.module("deposito").controller("detallesCargaCtrl",function($scope,$modalInstance,$http,id){$scope.entrada={},$scope.insumos=[],$scope.visibility=!1,$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.chvisibility=function(){$scope.search={},$scope.visibility=!$scope.visibility},$http.get("/inventario/herramientas/getInventarioCarga/"+id).success(function(response){$scope.nota=response.nota,$scope.insumos=response.insumos})}),angular.module("deposito").controller("successRegisterCtrl",function($scope,$modalInstance,response){$scope.response=response,$scope.ok=function(){$modalInstance.dismiss("cancel")}}),angular.module("deposito").controller("insumosAlertController",function($scope,$http,$modal){$scope.insumos=[],$scope.cRegistro="5",$scope.obtenerInsumos=function(){$http.get("/inventario/herramientas/getAlertInsumos").success(function(response){$scope.insumos=response})},$scope.calculaEstatus=function(min,med,exit){return exit<=min?"danger":exit<=med?"warning":void 0},$scope.obtenerInsumos()}),angular.module("deposito").controller("insumosController",function($scope,$http,$modal){$scope.insumos=[],$scope.cRegistro="5",$scope.registrarInsumo=function(){$modal.open({animation:!0,templateUrl:"/registrarInsumo",size:"lg",controller:"registraInsumoCtrl",resolve:{obtenerInsumos:function(){return $scope.obtenerInsumos}}})},$scope.obtenerInsumos=function(){$scope.ver=!0,$http.get("/getInsumos").success(function(response){$scope.insumos=response,$scope.ver=!1})},$scope.editarInsumo=function(index){$modal.open({animation:!0,templateUrl:"/editarInsumo",size:"lg",controller:"editarInsumoCtrl",resolve:{obtenerInsumos:function(){return $scope.obtenerInsumos},id:function(){return index}}})},$scope.elimInsumo=function(index){$modal.open({animation:!0,templateUrl:"/eliminarInsumo",controller:"eliminarInsumoCtrl",resolve:{obtenerInsumos:function(){return $scope.obtenerInsumos},id:function(){return index}}})},$scope.obtenerInsumos()}),angular.module("deposito").controller("registraInsumoCtrl",function($scope,$modalInstance,$http,obtenerInsumos){$scope.btnVisivilidad=!0,$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={codigo:$scope.codigo,descripcion:$scope.descripcion};$http.post("/registrarInsumo",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,"success"==response.status&&obtenerInsumos()})}}),angular.module("deposito").controller("editarInsumoCtrl",function($scope,$modalInstance,$http,obtenerInsumos,id){$scope.btnVisivilidad=!0,$scope.codigo="",$scope.descripcion="",$http.get("/getInsumo/"+id).success(function(response){$scope.codigo=response.codigo,$scope.descripcion=response.descripcion}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={codigo:$scope.codigo,descripcion:$scope.descripcion};$http.post("/editarInsumo/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,"success"==response.status&&obtenerInsumos()})}}),angular.module("deposito").controller("eliminarInsumoCtrl",function($scope,$modalInstance,$http,obtenerInsumos,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/eliminarInsumo/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,"success"==response.status&&obtenerInsumos()})}}),angular.module("deposito").controller("inventarioController",function($scope,$http,$modal){function empaquetaData(insumos){var insumosSelect=[];for(var insumo in insumos)insumos[insumo].select&&insumosSelect.push(insumos[insumo].id);return insumosSelect}$scope.insumos=[],$scope.cRegistro="5",$scope.status=!1,$scope.all=!1;var obtenerInsumos=function(data){$http.post("/inventario/getInventario",data).success(function(response){$scope.insumos=response.insumos,$scope.dateI=response.dateI,$scope.dateF=response.dateF,$scope.calculaEstatus($scope.insumos)})};$scope.calculaEstatus=function(insumos){for(var insumo in insumos)insumos[insumo].existencia<=insumos[insumo].min?insumos[insumo].color="danger":insumos[insumo].existencia<=insumos[insumo].med?insumos[insumo].color="warning":insumos[insumo].color=""},$scope.parcialInventario=function(){$scope.status=!0},$scope.closeSelect=function(){$scope.status=!1,$scope.unselectInsumos(),$scope.calculaEstatus($scope.insumos),$scope.all=!1},$scope.unselectInsumos=function(){for(var insumo in $scope.insumos)$scope.insumos[insumo].select=!1,$scope.insumos[insumo].color=""},$scope.select=function(){$scope.all?$scope.selectAll():$scope.unselectInsumos()},$scope.selectAll=function(){if($scope.busqueda)for(var insumo in $scope.insumos){var descripcion=$scope.insumos[insumo].descripcion.toLowerCase(),busqueda=$scope.busqueda.toLowerCase();descripcion.indexOf(busqueda)!=-1&&($scope.insumos[insumo].color="success",$scope.insumos[insumo].select=!0)}else for(var insumo in $scope.insumos)$scope.insumos[insumo].color="success",$scope.insumos[insumo].select=!0},$scope.selectInsumo=function(index){0!=$scope.status&&($scope.insumos[index].select?($scope.insumos[index].color="",$scope.insumos[index].select=!1):($scope.insumos[index].color="success",$scope.insumos[index].select=!0))},$scope.gerenarParcial=function(){var data={insumos:empaquetaData($scope.insumos),date:$scope.dateF};$scope.thereIsSelect()&&$http.post("/reportes/inventario/parcial",data,{responseType:"arraybuffer"}).success(function(response){var file=new Blob([response],{type:"application/pdf"}),fileURL=URL.createObjectURL(file);window.open(fileURL)})},$scope.thereIsSelect=function(){for(var insumo in $scope.insumos)if($scope.insumos[insumo].select)return!0;return!1},$scope.search=function(){$scope.busqueda={},$scope.barSearch=!$scope.barSearch},$scope.dateSelect=function(){$scope.modalInstance=$modal.open({animation:!0,templateUrl:"date.html",controller:"dateCtrl",resolve:{obtenerInsumos:function(){return obtenerInsumos}}})},$scope.current=function(){obtenerInsumos()},$scope.move=function(){var data={date:$scope.dateF,move:!0};obtenerInsumos(data)},obtenerInsumos()}),angular.module("deposito").controller("dateCtrl",function($scope,$modalInstance,obtenerInsumos){function dateForamat(date){if(null!=date){var month=date.getMonth()+1,day=date.getDate();return month<10&&(month="0"+month),day+"/"+month+"/"+date.getFullYear()}}function rangeDate(date){return date.getTime()<(new Date).getTime()}$scope.alert={},$scope.openI=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.openedI=!0},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.buscar=function(){var data={date:dateForamat($scope.fecha)};$scope.fecha?rangeDate($scope.fecha)?(obtenerInsumos(data),$modalInstance.dismiss("cancel")):$scope.alert={type:"danger",msg:"No es posible consultar una fecha superior a la actual"}:$scope.alert={type:"danger",msg:"Seleccione fecha a consultar"}},$scope.closeAlert=function(){$scope.alert={}}}),angular.module("deposito").controller("kardexController",function($scope,$http,$modal){$scope.movimientos=[],$scope.cRegistro="5",$scope.insumoInfo=insumoKardex;var obtenerKardex=function(filter){if(filter)filter.insumo=insumoKardex.id,filter.dateI=filter.dateI?filter.dateI:insumoKardex.dateI,filter.dateF=filter.dateF?filter.dateF:insumoKardex.dateF;else var filter={insumo:insumoKardex.id,dateI:insumoKardex.dateI,dateF:insumoKardex.dateF};$scope.insumoInfo={insumo:filter.insumo,dateI:filter.dateI,dateF:filter.dateF},$http.post("/inventario/kardex/getKardex",filter).success(function(response){$scope.movimientos=response.kardex})};$scope.filterPanel=function(){$scope.barSearch=!$scope.barSearch,$scope.filtro={}},$scope.detallesNota=function(type,index,inv){if("entrada"==type)if(inv)var search={view:"/inventario/herramientas/detallesCarga",data:"/inventario/herramientas/getInventarioCarga/",id:index};else var search={view:"/entradas/detalles",data:"/entradas/getEntrada/",id:index};else var search={view:"/detallesSalida",data:"/getSalida/",id:index};$modal.open({animation:!0,templateUrl:search.view,controller:"detallesNotaCtrl",windowClass:"large-Modal",resolve:{search:function(){return search}}})},$scope.search=function(){$modal.open({animation:!0,templateUrl:"/inventario/kardex/search",controller:"searchKardexCtrl",windowClass:"large-Modal",resolve:{obtenerKardex:function(){return obtenerKardex}}})},$scope.update=function(){obtenerKardex()},obtenerKardex()}),angular.module("deposito").controller("detallesNotaCtrl",function($scope,$modalInstance,$http,search){$scope.insumos=[],$scope.visibility=!1,$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.chvisibility=function(){$scope.search={},$scope.visibility=!$scope.visibility},$scope.detalles=function(){$http.get(search.data+search.id).success(function(response){$scope.nota=response.nota,$scope.insumos=response.insumos})},$scope.detalles()}),angular.module("deposito").controller("searchKardexCtrl",function($scope,$modalInstance,$http,obtenerKardex){
function dateForamat(date){if(null!=date){var month=date.getMonth()+1,day=date.getDate();return month<10&&(month="0"+month),day+"/"+month+"/"+date.getFullYear()}}function timeFormat(time){var hour=time.getHours(),minute=time.getMinutes();return hour<10&&(hour="0"+hour),minute<10&&(minute="0"+minute),hour+"-"+minute}$scope.data={},$scope.data.type="all",$scope.insumoSelect={},$scope.userSelect={},$scope.documentoSelect={},$scope.terceroSelect={},$scope.terceros=[],$scope.documentos=[],$scope.panelTerceros=!0,$http.get("/getUsuariosDeposito").success(function(response){var usuarios=response,userSet=[];for(var index in usuarios){var usuario={nombre:usuarios[index].nombre+" "+usuarios[index].apellido,id:usuarios[index].id};userSet.push(usuario)}$scope.usuarios=userSet});var getTerceros=function(){$http.get("/depositos/terceros").success(function(response){$scope.terceros=response})};$scope.refreshInsumos=function(insumo){$scope.searchAjax=!0;var params={insumo:insumo};return $http.get("/inventario/getInsumosInventario",{params:params}).then(function(response){$scope.listInsumos=response.data})},$scope.buscar=function(){parseAmount(),parseUser(),parseDate(),parseTime(),parseTercero(),parseDocumento(),obtenerKardex($scope.data),$modalInstance.dismiss("cancel")},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.insumoSearch=function(){$scope.insumop=!$scope.insumop},$scope.dateSearch=function(){$scope.datep=!$scope.datep},$scope.timeSearch=function(){$scope.timep=!$scope.timep,$scope.timeI=new Date,$scope.timeF=new Date},$scope.amounSearch=function(){$scope.amounp=!$scope.amounp},$scope.amounESearch=function(){$scope.amounEp=!$scope.amounEp},$scope.openI=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.openedI=!0},$scope.openF=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.openedF=!0},$scope.moviType=function(type){switch($scope.documentos=[],$scope.documentoSelect={},$scope.terceroSelect={},$scope.panelTerceros=!0,getTerceros(),type){case"entrada":$http.get("/documentos/all/entradas").success(function(response){$scope.documentos=response});break;case"salida":$http.get("/documentos/all/salidas").success(function(response){$scope.documentos=response});break;case"all":$http.get("/documentos/all").success(function(response){$scope.documentos=response})}};var parseAmount=function(){$scope.data.cantidadI&&$scope.data.cantidadF&&($scope.data.moveRange=!0),null!=$scope.data.existenciaF&&null!=$scope.data.existenciaF&&($scope.data.existRange=!0)},parseUser=function(){$scope.userSelect.hasOwnProperty("selected")&&($scope.data.user=$scope.userSelect.selected.id)},parseDate=function(){$scope.datep&&$scope.fechaI&&$scope.fechaF&&($scope.data.dateI=dateForamat($scope.fechaI),$scope.data.dateF=dateForamat($scope.fechaF),$scope.data.dateranger=!0)},parseTime=function(){$scope.timep&&($scope.data.horaI=timeFormat($scope.timeI),$scope.data.horaF=timeFormat($scope.timeF),$scope.data.hourrange=!0)},parseDocumento=function(){$scope.documentoSelect.hasOwnProperty("selected")&&($scope.data.concep=$scope.documentoSelect.selected.id)},parseTercero=function(){$scope.terceroSelect.hasOwnProperty("selected")&&($scope.data.tercero=$scope.terceroSelect.selected.id,$scope.data.tType=$scope.terceroSelect.selected.type,$scope.data.terceroSearch=!0)};$scope.searchTerceros=function(){$scope.documentoSelect.hasOwnProperty("selected")&&($scope.terceros=[],$scope.terceroSelect={},"interno"!=$scope.documentoSelect.selected.tipo?$http.get("/depositos/terceros/"+$scope.documentoSelect.selected.tipo).success(function(response){$scope.terceros=response,$scope.panelTerceros=!0}):$scope.panelTerceros=!1)},$http.get("/documentos/all").success(function(response){$scope.documentos=response}),getTerceros()}),angular.module("deposito").controller("modifiEntradasController",function($scope,$http,$modal){$scope.entradas=[],$scope.cRegistro="5",$scope.obtenerEntradas=function(){$http.get("/modificaciones/getEntradas").success(function(response){$scope.entradas=response})},$scope.registrarModificacion=function(){$modal.open({animation:!0,templateUrl:"/modificaciones/registrarEntrada",windowClass:"large-Modal",controller:"registraModificacionEntradaCtrl",resolve:{obtenerEntradas:function(){return $scope.obtenerEntradas}}})},$scope.detallesModificacion=function(index){$modal.open({animation:!0,templateUrl:"/modificaciones/detallesEntrada",controller:"detallesModificacionEntradaCtrl",windowClass:"large-Modal",resolve:{id:function(){return index}}})},$scope.obtenerEntradas()}),angular.module("deposito").controller("registraModificacionEntradaCtrl",function($scope,$modalInstance,$http,obtenerEntradas){function marcaInsumos(ids){var index,id;for(index in $scope.insumos)$scope.insumos[index].style="";for(id in ids)for(index=0;index<$scope.insumos.length;index++)if($scope.insumos[index].id==ids[id]){$scope.insumos[index].style="danger";break}}function serializeInsumos(){var index,insumos=[];for(index in $scope.insumos)insumos.push({id:$scope.insumos[index].id,cantidad:$scope.insumos[index].modificacion});return insumos}$scope.btnVisivilidad=!0,$scope.alert={},$scope.codigo="",$scope.orden="",$scope.provedor="",$scope.entrada={},$scope.insumos=[],$scope.status=!1,$scope.provedores=[],$http.get("/getProvedores").success(function(response){$scope.provedores=response}),$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(){$scope.alert={}},$scope.ubicarEntrada=function(){""==$scope.codigo?$scope.alert={type:"danger",msg:"Espefifique un codigo de Pro-Forma"}:$http.get("/entradas/getCodigo/"+$scope.codigo).success(function(response){return"danger"==response.status?void($scope.alert={type:response.status,msg:response.menssage}):($scope.entrada=response.entrada,$scope.insumos=response.insumos,$scope.alert={},void($scope.status=!0))})},$scope.save=function(){var $data={entrada:$scope.entrada.id,orden:$scope.orden,provedor:$scope.provedor,insumos:serializeInsumos()};$http.post("/modificaciones/registrarEntrada",$data).success(function(response){return $scope.alert={},"unexist"==response.status?(marcaInsumos(response.data),void($scope.alert={type:"danger",msg:"La cantidad de los insumos marcados no puede ser modificada por este monto, por favor verifique el inventario"})):($scope.alert={type:response.status,msg:response.menssage},void("success"==response.status&&($scope.btnVisivilidad=!1,obtenerEntradas())))})}}),angular.module("deposito").controller("detallesModificacionEntradaCtrl",function($scope,$modalInstance,$http,id){$scope.entrada={},$scope.insumos=[],$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.detalles=function(){$http.get("/modificaciones/getEntradas/"+id).success(function(response){$scope.modificacion=response.modificacion,$scope.entrada=response.entrada,$scope.insumos=response.insumos})},$scope.detalles(id)}),angular.module("deposito").controller("modifiSalidasController",function($scope,$http,$modal){$scope.salidas=[],$scope.cRegistro="5",$scope.obtenerSalidas=function(){$http.get("/modificaciones/getSalidas").success(function(response){$scope.salidas=response})},$scope.registrarModificacion=function(){$modal.open({animation:!0,templateUrl:"/modificaciones/registrarSalida",windowClass:"large-Modal",controller:"registraModificacionSalidaCtrl",resolve:{obtenerSalidas:function(){return $scope.obtenerSalidas}}})},$scope.detallesModificacion=function(index){$modal.open({animation:!0,templateUrl:"/modificaciones/detallesSalida",controller:"detallesModificacionSalidaCtrl",windowClass:"large-Modal",resolve:{id:function(){return index}}})},$scope.obtenerSalidas()}),angular.module("deposito").controller("registraModificacionSalidaCtrl",function($scope,$modalInstance,$http,obtenerSalidas){function marcaInsumos(ids){var index,id;for(index in $scope.insumos)$scope.insumos[index].style="";for(id in ids)for(index=0;index<$scope.insumos.length;index++)if($scope.insumos[index].id==ids[id]){$scope.insumos[index].style="danger";break}}function serializeInsumos(){var index,insumos=[];for(index in $scope.insumos)insumos.push({id:$scope.insumos[index].id,solicitado:$scope.insumos[index].Msolicitado,despachado:$scope.insumos[index].Mdespachado});return insumos}$scope.btnVisivilidad=!0,$scope.alert={},$scope.codigo="",$scope.orden="",$scope.departamento="",$scope.salida={},$scope.insumos=[],$scope.status=!1,$scope.departamentos=[],$http.get("/getDepartamentos").success(function(response){$scope.departamentos=response}),$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(){$scope.alert={}},$scope.ubicarSalida=function(){""==$scope.codigo?$scope.alert={type:"danger",msg:"Espefifique un codigo de Pro-Forma"}:$http.get("/getSalidaCodigo/"+$scope.codigo).success(function(response){return"danger"==response.status?void($scope.alert={type:response.status,msg:response.menssage}):($scope.salida=response.salida,$scope.insumos=response.insumos,$scope.alert={},void($scope.status=!0))})},$scope.save=function(){var $data={salida:$scope.salida.id,departamento:$scope.departamento,insumos:serializeInsumos()};$http.post("/modificaciones/registrarSalida",$data).success(function(response){return $scope.alert={},"unexist"==response.status?(marcaInsumos(response.data),void($scope.alert={type:"danger",msg:"La cantidad de los insumos marcados no puede ser modificada por este monto, por favor verifique el inventario"})):($scope.alert={type:response.status,msg:response.menssage},void("success"==response.status&&($scope.btnVisivilidad=!1,obtenerSalidas())))})}}),angular.module("deposito").controller("detallesModificacionSalidaCtrl",function($scope,$modalInstance,$http,id){$scope.salida={},$scope.insumos=[],$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.detalles=function(){$http.get("/modificaciones/getSalida/"+id).success(function(response){$scope.modificacion=response.modificacion,$scope.salida=response.salida,$scope.insumos=response.insumos})},$scope.detalles(id)}),angular.module("deposito").controller("presentacionesController",function($scope,$http,$modal){$scope.presentaciones=[],$scope.registrarPresentacion=function(){$modal.open({animation:!0,templateUrl:"/registrarPresentacion",size:"lg",controller:"registraPresentacionCtrl",resolve:{obtenerPresentaciones:function(){return $scope.obtenerPresentaciones}}})},$scope.obtenerPresentaciones=function(){$http.get("/getPresentaciones").success(function(response){$scope.presentaciones=response})},$scope.editarPresentacion=function(index){$modal.open({animation:!0,templateUrl:"/editarPresentacion",size:"lg",controller:"editarPresentacionCtrl",resolve:{obtenerPresentaciones:function(){return $scope.obtenerPresentaciones},id:function(){return index}}})},$scope.eliminarPresentacion=function(index){$modal.open({animation:!0,templateUrl:"/eliminarPresentacion",controller:"eliminarPresentacionCtrl",resolve:{obtenerPresentaciones:function(){return $scope.obtenerPresentaciones},id:function(){return index}}})},$scope.obtenerPresentaciones()}),angular.module("deposito").controller("registraPresentacionCtrl",function($scope,$modalInstance,$http,obtenerPresentaciones){$scope.btnVisivilidad=!0,$scope.nombre="",$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/registrarPresentacion",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerPresentaciones()})}}),angular.module("deposito").controller("editarPresentacionCtrl",function($scope,$modalInstance,$http,obtenerPresentaciones,id){$scope.btnVisivilidad=!0,$scope.nombre="",$http.get("/getPresentacion/"+id).success(function(response){$scope.nombre=response.nombre}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/editarPresentacion/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerPresentaciones()})}}),angular.module("deposito").controller("eliminarPresentacionCtrl",function($scope,$modalInstance,$http,obtenerPresentaciones,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/eliminarPresentacion/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerPresentaciones()})}}),angular.module("deposito").controller("provedoresController",function($scope,$http,$modal){$scope.provedores=[],$scope.cRegistro="5",$scope.registraProvedor=function(){$modal.open({animation:!0,templateUrl:"/registraProvedor",size:"lg",controller:"registraProvedorCtrl",resolve:{obtenerProvedores:function(){return $scope.obtenerProvedores}}})},$scope.obtenerProvedores=function(){$http.get("/getProvedores").success(function(response){$scope.provedores=response})},$scope.editarProvedor=function(index){$modal.open({animation:!0,templateUrl:"/editarProvedor",size:"lg",controller:"editarProvedorCtrl",resolve:{obtenerProvedores:function(){return $scope.obtenerProvedores},id:function(){return index}}})},$scope.elimProvedor=function(index){$modal.open({animation:!0,templateUrl:"/elimProvedor",controller:"elimProvedorCtrl",resolve:{obtenerProvedores:function(){return $scope.obtenerProvedores},id:function(){return index}}})},$scope.obtenerProvedores()}),angular.module("deposito").controller("registraProvedorCtrl",function($scope,$modalInstance,$http,obtenerProvedores){$scope.btnVisivilidad=!0,$scope.rif="",$scope.nombre="",$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={rif:$scope.rif,nombre:$scope.nombre};$http.post("/registraProvedor",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerProvedores()})}}),angular.module("deposito").controller("editarProvedorCtrl",function($scope,$modalInstance,$http,obtenerProvedores,id){$scope.btnVisivilidad=!0,$scope.rif="",$scope.nombre="",$http.get("/getProvedor/"+id).success(function(response){$scope.rif=response.rif,$scope.nombre=response.nombre}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/editProvedor/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerProvedores()})}}),angular.module("deposito").controller("elimProvedorCtrl",function($scope,$modalInstance,$http,obtenerProvedores,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/elimProvedor/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerProvedores()})}}),angular.module("deposito").controller("registroEntradaController",function($scope,$http,$modal){function insumoExist(codigo,insumos){var index;for(index in insumos)if(insumos[index].codigo==codigo)return!0;return!1}function validaCantidad(insumos){var index;for(index in insumos)if(!insumos[index].cantidad||insumos[index].cantidad<0)return!1;return!0}function empaquetaData(){var index,insumos=[];for(index in $scope.insumos)insumos.push({id:$scope.insumos[index].id,cantidad:$scope.insumos[index].cantidad,fecha:dataForamat($scope.insumos[index].fecha),lote:$scope.insumos[index].lote});return insumos}function dataForamat(data){if(null!=data){var month=data.getMonth()+1,day=data.getDate();return day<10&&(day="0"+day),month<10&&(month="0"+month),data.getFullYear()+"-"+month+"-"+day}}$scope.insumoSelect={},$scope.terceroSelect={},$scope.documentoSelect={},$scope.documentos=[],$scope.terceros=[],$scope.insumos=[],$scope.listInsumos=[],$scope.alert={},$scope.openI=function($event,dI){$event.preventDefault(),$event.stopPropagation(),$scope.insumos[dI].dI=!0},$scope.refreshInsumos=function(insumo){var params={insumo:insumo};return $http.get("/getInsumosConsulta",{params:params}).then(function(response){$scope.listInsumos=response.data})},$http.get("/documentos/all/entradas").success(function(response){$scope.documentos=response}),$scope.agregarInsumos=function(){return $scope.insumoSelect.selected?insumoExist($scope.insumoSelect.selected.codigo,$scope.insumos)?void($scope.alert={type:"danger",msg:"Este insumo ya se ha agregado en esta entrada"}):($scope.insumos.unshift({id:$scope.insumoSelect.selected.id,codigo:$scope.insumoSelect.selected.codigo,descripcion:$scope.insumoSelect.selected.descripcion,dI:null}),void($scope.insumoSelect={})):void($scope.alert={type:"danger",msg:"Por favor especifique un insumo"})},$scope.registrar=function(){return validaCantidad($scope.insumos)?($scope.modalInstance=$modal.open({animation:!0,templateUrl:"confirmeRegister.html",scope:$scope}),$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},void($scope.cofirme=function(){save(),$scope.modalInstance.dismiss("cancel"),$scope.loader=!0})):void($scope.alert={type:"danger",msg:"Especifique un valor valido para cada insumo"})};var save=function(){var data={documento:parseDocumento(),tercero:parseTercero(),insumos:empaquetaData()};$http.post("/entradas/registrar",data).success(function(response){return $scope.loader=!1,"success"==response.status?($modal.open({animation:!0,templateUrl:"successRegister.html",controller:"successRegisterCtrl",resolve:{response:function(){return response}}}),void $scope.restablecer()):void($scope.alert={type:response.status,msg:response.menssage})})};$scope.eliminarInsumo=function(index){$scope.insumos.splice(index,1)},$scope.closeAlert=function(){$scope.alert={}},$scope.thereInsumos=function(){return $scope.insumos.length>0},$scope.restablecer=function(){$scope.insumos=[],$scope.alert={},$scope.documentoSelect={},$scope.terceroSelect={},$scope.panelTerceros=!1,$scope.insumoSelect={}};var parseDocumento=function(){return $scope.documentoSelect.hasOwnProperty("selected")?$scope.documentoSelect.selected.id:""},parseTercero=function(){return $scope.terceroSelect.hasOwnProperty("selected")?$scope.terceroSelect.selected.id:""};$scope.searchTerceros=function(){$scope.documentoSelect.hasOwnProperty("selected")&&($scope.terceros=[],$scope.terceroSelect={},"interno"!=$scope.documentoSelect.selected.tipo?$http.get("/depositos/terceros/"+$scope.documentoSelect.selected.tipo).success(function(response){$scope.terceros=response,$scope.panelTerceros=!0}):$scope.panelTerceros=!1)}}),angular.module("deposito").controller("successRegisterCtrl",function($scope,$modalInstance,response){$scope.response=response,$scope.ok=function(){$modalInstance.dismiss("cancel")}}),angular.module("deposito").controller("registroSalidaController",function($scope,$http,$modal){function insumoExist(codigo){var index;for(index in $scope.insumos)if($scope.insumos[index].codigo==codigo)return!0;return!1}function validaCantidad(){var index;for(index in $scope.insumos)if(!$scope.insumos[index].despachado||$scope.insumos[index].despachado<0||$scope.insumos[index].solicitado<$scope.insumos[index].despachado)return!1;return!0}function empaquetaData(){var index,insumos=[];for(index in $scope.insumos)insumos.push({id:$scope.insumos[index].id,solicitado:$scope.insumos[index].solicitado,despachado:$scope.insumos[index].despachado});return insumos}function marcaInsumos(ids){var index,id;for(index in $scope.insumos)$scope.insumos[index].style="";for(id in ids)for(index=0;index<$scope.insumos.length;index++)if($scope.insumos[index].id==ids[id]){$scope.insumos[index].style="danger";break}}function restablecer(){$scope.insumos=[],$scope.terceros=[],$scope.alert={},$scope.documentoSelect={},$scope.terceroSelect={},$scope.panelTerceros=!1,$scope.insumoSelect={}}$scope.insumoSelect={},$scope.terceroSelect={},$scope.documentoSelect={},$scope.terceros=[],$scope.documentos=[],$scope.listInsumos=[],$scope.insumos=[],$scope.alert={},$scope.refreshInsumos=function(insumo){var params={insumo:insumo};return $http.get("inventario/getInsumosInventario",{params:params}).then(function(response){$scope.listInsumos=response.data})},$http.get("/documentos/all/salidas").success(function(response){$scope.documentos=response}),$scope.agregarInsumos=function(){return $scope.insumoSelect.selected?insumoExist($scope.insumoSelect.selected.codigo)?void($scope.alert={type:"danger",msg:"Este insumo ya se ha agregado en esta entrada"}):($scope.insumos.unshift({id:$scope.insumoSelect.selected.id,codigo:$scope.insumoSelect.selected.codigo,descripcion:$scope.insumoSelect.selected.descripcion}),void($scope.insumoSelect={})):void($scope.alert={type:"danger",msg:"Por favor especifique un insumo"})},$scope.registrar=function(){return validaCantidad()?($scope.modalInstance=$modal.open({animation:!0,templateUrl:"confirmeRegister.html",scope:$scope}),$scope.cancel=function(){$scope.modalInstance.dismiss("cancel")},void($scope.cofirme=function(){save(),$scope.modalInstance.dismiss("cancel"),$scope.loader=!0})):void($scope.alert={type:"danger",msg:"Especifique valores validos para cada insumo"})};var save=function($data){var $data={documento:parseDocumento(),tercero:parseTercero(),insumos:empaquetaData()};$http.post("/registrarSalida",$data).success(function(response){return $scope.loader=!1,"unexist"==response.status?(marcaInsumos(response.data),void($scope.alert={type:"danger",msg:"La cantidad de los insumos marcados son insuficientes"})):"success"==response.status?($modal.open({animation:!0,templateUrl:"successRegister.html",controller:"successRegisterCtrl",resolve:{response:function(){return response}}}),void restablecer()):void($scope.alert={type:response.status,msg:response.menssage})})};$scope.eliminarInsumo=function(index){$scope.insumos.splice(index,1)},$scope.closeAlert=function(){$scope.alert={}},$scope.thereInsumos=function(){return $scope.insumos.length>0},$scope.searchTerceros=function(){$scope.documentoSelect.hasOwnProperty("selected")&&($scope.terceros=[],$scope.terceroSelect={},"interno"!=$scope.documentoSelect.selected.tipo?$http.get("/depositos/terceros/"+$scope.documentoSelect.selected.tipo).success(function(response){$scope.terceros=response,$scope.panelTerceros=!0}):$scope.panelTerceros=!1)};var parseDocumento=function(){return $scope.documentoSelect.hasOwnProperty("selected")?$scope.documentoSelect.selected.id:""},parseTercero=function(){return $scope.terceroSelect.hasOwnProperty("selected")?$scope.terceroSelect.selected.id:""}}),angular.module("deposito").controller("successRegisterCtrl",function($scope,$modalInstance,response){$scope.response=response,$scope.ok=function(){$modalInstance.dismiss("cancel")}}),angular.module("deposito").controller("rolesController",function($scope,$http,$modal){$scope.roles=[],$scope.cRegistro="5",$scope.obtenerRoles=function(){$http.get("/roles/all").success(function(response){$scope.roles=response})},$scope.registrarRol=function(){$modal.open({animation:!0,templateUrl:"/roles/registrar",windowClass:"large-Modal",controller:"registrarRolCtrl",resolve:{obtenerRoles:function(){return $scope.obtenerRoles}}})},$scope.editarRol=function(index){$modal.open({animation:!0,templateUrl:"/roles/editar",windowClass:"large-Modal",controller:"editarRolCtr",resolve:{obtenerRoles:function(){return $scope.obtenerRoles},id:function(){return index}}})},$scope.eliminarRol=function(index){$modal.open({animation:!0,templateUrl:"/roles/eliminar",controller:"eliminarRolCtrl",resolve:{obtenerRoles:function(){return $scope.obtenerRoles},id:function(){return index}}})},$scope.obtenerRoles()}),angular.module("deposito").controller("registrarRolCtrl",function($scope,$modalInstance,$http,obtenerRoles){$scope.btnVisivilidad=!0,$scope.registro={},$scope.permisos=[];var permisos=[];$http.get("/roles/permisos").success(function(response){$scope.permisos=response}),$scope.assignPermission=function(permiso){var index=permisos.indexOf(permiso);index!=-1?permisos.splice(index,1):permisos.push(permiso)},$scope.registrar=function(){var data={nombre:$scope.nombre,permisos:permisos};$http.post("/roles/registrar",data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.message}),"success"==response.status&&($scope.btnVisivilidad=!1,obtenerRoles())})},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)}}),angular.module("deposito").controller("editarRolCtr",function($scope,$modalInstance,$http,obtenerRoles,id){$scope.btnVisivilidad=!0,$scope.data={},$scope.data.permisos=[],$scope.alert=!1;$http.get("/roles/permisos").success(function(response){$scope.permisos=response}),$http.get("/roles/getRol/"+id).success(function(response){$scope.data.permisos=response.permisos,$scope.data.nombre=response.nombre}),$scope.assignPermission=function(permiso){var index=$scope.data.permisos.indexOf(permiso);index!=-1?$scope.data.permisos.splice(index,1):$scope.data.permisos.push(permiso)},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(){$scope.alert=!1},$scope.isAsignedPermission=function(permiso){return $scope.data.permisos.indexOf(permiso)!=-1},$scope.registrar=function(){$http.post("/roles/editar/"+id,$scope.data).success(function(response){$scope.alert={type:response.status,msg:response.message},"success"==response.status&&($scope.btnVisivilidad=!1,obtenerRoles())})}}),angular.module("deposito").controller("eliminarRolCtrl",function($scope,$modalInstance,$http,obtenerRoles,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope["delete"]()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alert={}},$scope["delete"]=function(){$http.post("/roles/eliminar/"+id).success(function(response){$scope.alert={},$scope.alert={type:response.status,msg:response.message},$scope.btnVisivilidad="success"!=response.status,obtenerRoles()})}}),angular.module("deposito").controller("salidasController",function($scope,$http,$modal){$scope.salidas=[],$scope.indice="Pro-Formas",$scope.salidasInsumos=[],$scope.cRegistro="5",$scope.status=!0,$scope.obtenerSalidas=function(type,query){"search"==type?$http.get("/getSearch",query).success(function(response){$scope.salidas=response}):$http.get("/getSalidas").success(function(response){$scope.salidas=response})},$scope.obtenerSalidasInsumos=function(){$http.get("/getInsumosSalidas").success(function(response){$scope.salidasInsumos=response})},$scope.registrosProformas=function(){$scope.busqueda="",$scope.indice="Pro-Formas",$scope.salidasInsumos=[],$scope.status=!0,$scope.obtenerSalidas()},$scope.registrosInsumos=function(){$scope.busqueda="",$scope.indice="Insumos",$scope.insumos=[],$scope.status=!1,$scope.obtenerSalidasInsumos()},$scope.detallesSalida=function(index){$modal.open({animation:!0,templateUrl:"/detallesSalida",controller:"detallesSalidaCtrl",windowClass:"large-Modal",resolve:{id:function(){return index}}})},$scope.obtenerSalidas()}),angular.module("deposito").controller("detallesSalidaCtrl",function($scope,$modalInstance,$http,id){$scope.salida={},$scope.insumos=[],$scope.visibility=!1,$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.chvisibility=function(){$scope.search={},$scope.visibility=!$scope.visibility},$scope.detalles=function(){$http.get("/getSalida/"+id).success(function(response){$scope.nota=response.nota,$scope.insumos=response.insumos})},$scope.detalles(id)}),angular.module("deposito").controller("seccionesController",function($scope,$http,$modal){$scope.secciones=[],$scope.registrarSeccion=function(){$modal.open({animation:!0,templateUrl:"/registrarSeccion",size:"lg",controller:"registraSeccionCtrl",resolve:{obtenerSecciones:function(){return $scope.obtenerSecciones}}})},$scope.obtenerSecciones=function(){$http.get("/getSecciones").success(function(response){$scope.secciones=response})},$scope.editarSeccion=function(index){$modal.open({animation:!0,templateUrl:"/editarSeccion",size:"lg",controller:"editarSeccionCtrl",resolve:{obtenerSecciones:function(){return $scope.obtenerSecciones},id:function(){return index}}})},$scope.eliminarSeccion=function(index){$modal.open({animation:!0,templateUrl:"/eliminarSeccion",controller:"eliminarSeccionesCtrl",resolve:{obtenerSecciones:function(){return $scope.obtenerSecciones},id:function(){return index}}})},$scope.obtenerSecciones()}),angular.module("deposito").controller("registraSeccionCtrl",function($scope,$modalInstance,$http,obtenerSecciones){$scope.btnVisivilidad=!0,$scope.nombre="",$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/registrarSeccion",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerSecciones()})}}),angular.module("deposito").controller("editarSeccionCtrl",function($scope,$modalInstance,$http,obtenerSecciones,id){$scope.btnVisivilidad=!0,$scope.nombre="",$http.get("/getSeccion/"+id).success(function(response){$scope.nombre=response.nombre}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/editarSeccion/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerSecciones()})}}),angular.module("deposito").controller("eliminarSeccionesCtrl",function($scope,$modalInstance,$http,obtenerSecciones,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/eliminarSeccion/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerSecciones()})}}),angular.module("deposito").controller("unidadMedidasController",function($scope,$http,$modal){$scope.unidadMedidas=[],$scope.registrarUnidadMedida=function(){$modal.open({animation:!0,templateUrl:"/registrarMedida",size:"lg",controller:"registrarMedidaCtrl",resolve:{obtenerUnidadMedidas:function(){return $scope.obtenerUnidadMedidas}}})},$scope.obtenerUnidadMedidas=function(){$http.get("/getMedidas").success(function(response){$scope.unidadMedidas=response})},$scope.editarUnidadMedida=function(index){$modal.open({animation:!0,templateUrl:"/editarMedida",size:"lg",controller:"editarMedidaCtrl",resolve:{obtenerUnidadMedidas:function(){return $scope.obtenerUnidadMedidas},id:function(){return index;
}}})},$scope.eliminarUnidadMedida=function(index){$modal.open({animation:!0,templateUrl:"/eliminarMedida",controller:"eliminarMedidaCtrl",resolve:{obtenerUnidadMedidas:function(){return $scope.obtenerUnidadMedidas},id:function(){return index}}})},$scope.obtenerUnidadMedidas()}),angular.module("deposito").controller("registrarMedidaCtrl",function($scope,$modalInstance,$http,obtenerUnidadMedidas){$scope.btnVisivilidad=!0,$scope.nombre="",$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/registrarMedida",$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerUnidadMedidas()})}}),angular.module("deposito").controller("editarMedidaCtrl",function($scope,$modalInstance,$http,obtenerUnidadMedidas,id){$scope.btnVisivilidad=!0,$scope.nombre="",$http.get("/getMedida/"+id).success(function(response){$scope.nombre=response.nombre}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.save=function(){var $data={nombre:$scope.nombre};$http.post("/editarMedida/"+id,$data).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerUnidadMedidas()})}}),angular.module("deposito").controller("eliminarMedidaCtrl",function($scope,$modalInstance,$http,obtenerUnidadMedidas,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/eliminarMedida/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerUnidadMedidas()})}}),angular.module("deposito").controller("usersController",function($scope,$http,$modal){$scope.usuarios=[],$scope.cRegistro="5",$scope.registrarUser=function(){$modal.open({animation:!0,templateUrl:"/registrarUser",windowClass:"large-Modal",controller:"registraUsuarioCtrl",resolve:{obtenerUsuarios:function(){return $scope.obtenerUsuarios}}})},$scope.obtenerUsuarios=function(){$http.get("/getUsuarios").success(function(response){$scope.usuarios=response})},$scope.editarUsuario=function(index){$modal.open({animation:!0,templateUrl:"/editarUsuario",windowClass:"large-Modal",controller:"editarUsuarioCtrl",resolve:{obtenerUsuarios:function(){return $scope.obtenerUsuarios},id:function(){return index}}})},$scope.elimUsuario=function(index){$modal.open({animation:!0,templateUrl:"/eliminarUsuario",controller:"elimUsuarioCtrl",resolve:{obtenerUsuarios:function(){return $scope.obtenerUsuarios},id:function(){return index}}})},$scope.obtenerUsuarios()}),angular.module("deposito").controller("registraUsuarioCtrl",function($scope,$modalInstance,$http,obtenerUsuarios){$scope.btnVisivilidad=!0,$scope.depositos=[],$scope.roles=[],$scope.alert=!1,$http.get("/depositos/getDepositos").success(function(response){$scope.depositos=response}),$http.get("/roles/all").success(function(response){$scope.roles=response}),$scope.registrar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alert=!1},$scope.save=function(){$http.post("/registrarUsuario",$scope.data).success(function(response){$scope.alert={type:response.status,msg:response.menssage},$scope.btnVisivilidad="success"!=response.status,obtenerUsuarios()})}}),angular.module("deposito").controller("editarUsuarioCtrl",function($scope,$modalInstance,$http,obtenerUsuarios,id){$scope.btnVisivilidad=!0,$scope.data={},$scope.depositos=[],$scope.roles=[],$http.get("/depositos/getDepositos").success(function(response){$scope.depositos=response,$http.get("/getUsuario/"+id).success(function(response){$scope.data=response.usuario,$scope.data.deposito=String(response.usuario.deposito),$scope.data.rol=String(response.usuario.rol)})}),$http.get("/roles/all").success(function(response){$scope.roles=response}),$scope.modificar=function(){$scope.save()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alert=!1},$scope.save=function(){$http.post("/editarUsuario/"+id,$scope.data).success(function(response){$scope.alert={type:response.status,msg:response.menssage},"success"==response.status&&($scope.btnVisivilidad=!1,obtenerUsuarios())})}}),angular.module("deposito").controller("elimUsuarioCtrl",function($scope,$modalInstance,$http,obtenerUsuarios,id){$scope.btnVisivilidad=!0,$scope.eliminar=function(){$scope.delet()},$scope.cancelar=function(){$modalInstance.dismiss("cancel")},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.delet=function(){$http.post("/eliminarUsuario/"+id).success(function(response){$scope.alerts=[],$scope.alerts.push({type:response.status,msg:response.menssage}),$scope.btnVisivilidad="success"!=response.status,obtenerUsuarios()})}});